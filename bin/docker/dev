#!/usr/bin/env bash

set -e

COMPOSE_FILE="docker-compose.dev.yml"

# If no arguments provided, start the development environment
if [ $# -eq 0 ]; then
    echo "ğŸš€ Starting Rails app in Docker development mode..."
    docker compose -f $COMPOSE_FILE up --build
    echo "âœ… Development environment started!"
    echo "ğŸ“± Rails app: http://localhost:3000"
    echo "ğŸ—„ï¸  PostgreSQL: localhost:5432"
    echo ""
    echo "To stop: ./bin/docker/dev down"
    echo "To view logs: ./bin/docker/dev logs"
else
    # Pass all arguments to docker compose with error handling
    if ! docker compose -f $COMPOSE_FILE "$@"; then
        echo "âŒ Docker command failed. Common issues:"
        echo "  - Missing packages in Dockerfile (e.g., apt-utils)"
        echo "  - Network connectivity issues"
        echo "  - Invalid docker-compose.dev.yml configuration"
        echo ""
        echo "Try: ./bin/docker/dev build --no-cache"
        exit 1
    fi
fi
